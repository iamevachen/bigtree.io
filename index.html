<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星火计划 | 数据统计</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        beige: '#D6CFBB',     // 浅米驼
                        dustyRed: '#D8575D',  // 复古豆沙红
                        mistyBlue: '#A3BBCE', // 雾霾浅蓝
                        neutralGray: '#808080'// 中性深灰
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');
        body { background-color: #D6CFBB; color: #333; font-family: 'Noto Serif SC', serif; }
        
        /* 保持左侧图标文字完全对齐布局 */
        .nav-btn { @apply flex flex-col items-center justify-center gap-1 py-6 transition-all border-b border-black/5 text-neutralGray; }
        .nav-active { @apply bg-white/40 text-dustyRed border-r-4 border-r-dustyRed; }
        
        .retro-card { background: #FCF9F2; border: 1px solid #C9C0A8; box-shadow: 2px 2px 0px #B5AD96; }
        .retro-input { background: #F2EEE4; border: 1px solid #B5AD96; border-radius: 4px; padding: 10px; outline: none; }
        
        /* 新增：预览小眼睛样式 */
        .preview-container { @apply relative w-20 h-20 border border-[#B5AD96] rounded overflow-hidden group; }
        .eye-overlay { @apply absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-all cursor-pointer; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-24 bg-[#CFC8B4] border-r border-[#B5AD96] flex flex-col shrink-0">
        <div class="h-24 flex items-center justify-center border-b border-[#B5AD96]">
            <div class="w-10 h-10 bg-dustyRed rounded-full flex items-center justify-center">
                <i data-lucide="flame" class="text-beige w-6 h-6"></i>
            </div>
        </div>
        <nav class="flex-1 overflow-y-auto">
            <button onclick="app.navigate('dashboard')" id="nav-dashboard" class="nav-btn w-full nav-active">
                <i data-lucide="compass" class="w-6 h-6"></i><span class="text-xs font-bold">看板</span>
            </button>
            <button onclick="app.navigate('data')" id="nav-data" class="nav-btn w-full">
                <i data-lucide="scroll-text" class="w-6 h-6"></i><span class="text-xs font-bold">数据</span>
            </button>
            <button onclick="app.navigate('wall')" id="nav-wall" class="nav-btn w-full">
                <i data-lucide="layout-grid" class="w-6 h-6"></i><span class="text-xs font-bold">爆文墙</span>
            </button>
            <button onclick="app.navigate('mine')" id="nav-mine" class="nav-btn w-full border-b-0">
                <i data-lucide="user-square-2" class="w-6 h-6"></i><span class="text-xs font-bold">我的</span>
            </button>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="h-20 flex items-center justify-between px-10 border-b border-[#B5AD96]/50">
            <h2 id="page-title" class="text-xl font-bold tracking-widest">看板 / DASHBOARD</h2>
            <button onclick="app.openModal()" class="bg-dustyRed px-6 py-3 text-white text-xs font-bold tracking-widest rounded-sm shadow-[3px_3px_0px_#801115]">
                录入成果
            </button>
        </header>

        <section id="content-area" class="flex-1 overflow-y-auto p-10 space-y-8"></section>
    </main>

    <div id="modal" class="fixed inset-0 z-50 hidden bg-black/30 backdrop-blur-[2px] flex items-center justify-center p-4">
        <div class="retro-card w-full max-w-xl p-10">
            <div class="flex justify-between items-center mb-6 border-b-2 border-black pb-4">
                <h3 class="text-xl font-bold italic uppercase">Entry / 新增记录</h3>
                <button onclick="app.closeModal()"><i data-lucide="x-circle"></i></button>
            </div>
            
            <form id="entryForm" class="space-y-4">
                <input type="text" id="title" placeholder="笔记标题" class="retro-input w-full" required>
                
                <div class="flex items-center gap-4 p-4 border border-dashed border-neutralGray rounded">
                    <div onclick="document.getElementById('fileInput').click()" class="cursor-pointer text-center">
                        <i data-lucide="image-plus" class="mx-auto text-neutralGray"></i>
                        <p class="text-[10px] font-bold mt-1">上传封面/截图</p>
                        <input type="file" id="fileInput" class="hidden" accept="image/*" onchange="app.handleUpload(this)">
                    </div>
                    <div id="previewBox" class="hidden preview-container">
                        <img id="previewImg" src="" class="w-full h-full object-cover">
                        <div class="eye-overlay" onclick="app.viewLarge()">
                            <i data-lucide="eye" class="text-white w-5 h-5"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-2">
                    <input id="r" type="number" placeholder="阅读" class="retro-input text-center">
                    <input id="l" type="number" placeholder="点赞" class="retro-input text-center">
                    <input id="s" type="number" placeholder="收藏" class="retro-input text-center">
                    <input id="c" type="number" placeholder="评论" class="retro-input text-center">
                </div>

                <textarea id="review" placeholder="一句话复盘：这篇笔记做对了什么？" class="retro-input w-full h-20 text-sm"></textarea>

                <button type="submit" class="w-full bg-dustyRed py-4 text-white font-bold uppercase tracking-widest shadow-[3px_3px_0px_#801115]">
                    保存记录
                </button>
            </form>
        </div>
    </div>

    <div id="zoomOverlay" class="fixed inset-0 z-[100] hidden bg-black/90 flex items-center justify-center" onclick="this.classList.add('hidden')">
        <img id="zoomImg" src="" class="max-w-[90%] max-h-[90%] border-4 border-white">
    </div>

    <script>
        const app = {
            state: { view: 'dashboard', currentImg: null, db: JSON.parse(localStorage.getItem('spark_final_db')) || [] },
            init() { lucide.createIcons(); this.navigate('dashboard'); },
            navigate(v) {
                this.state.view = v;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
                document.getElementById(`nav-${v}`).classList.add('nav-active');
                this.render();
            },
            handleUpload(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.state.currentImg = e.target.result;
                        document.getElementById('previewImg').src = e.target.result;
                        document.getElementById('previewBox').classList.remove('hidden');
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            },
            viewLarge() {
                document.getElementById('zoomImg').src = this.state.currentImg;
                document.getElementById('zoomOverlay').classList.remove('hidden');
            },
            render() {
                const el = document.getElementById('content-area');
                if(this.state.view === 'data') {
                    el.innerHTML = `
                        <div class="retro-card overflow-hidden">
                            <table class="w-full text-left text-xs">
                                <thead class="bg-[#F2EEE4] border-b border-[#B5AD96] font-bold">
                                    <tr><th class="px-6 py-4">凭证</th><th class="px-6 py-4">标题</th><th class="px-6 py-4">阅读</th><th class="px-6 py-4">复盘</th></tr>
                                </thead>
                                <tbody>
                                    ${this.state.db.map(n => `
                                        <tr class="border-b border-[#B5AD96]/20">
                                            <td class="px-6 py-3">${n.img ? `<img src="${n.img}" class="w-8 h-8 rounded border">` : '-'}</td>
                                            <td class="px-6 py-3 font-bold">${n.title}</td>
                                            <td class="px-6 py-3 text-mistyBlue font-bold">${n.read}</td>
                                            <td class="px-6 py-3 italic text-neutralGray">${n.review || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>`;
                } else {
                    el.innerHTML = `<div class="p-20 text-center text-neutralGray italic">看板/其他页面内容保持不变...</div>`;
                }
                lucide.createIcons();
            },
            openModal() { document.getElementById('modal').classList.remove('hidden'); },
            closeModal() { document.getElementById('modal').classList.add('hidden'); }
        };

        document.getElementById('entryForm').onsubmit = (e) => {
            e.preventDefault();
            const newItem = {
                title: document.getElementById('title').value,
                read: document.getElementById('r').value,
                review: document.getElementById('review').value,
                img: app.state.currentImg,
                id: Date.now()
            };
            app.state.db.unshift(newItem);
            localStorage.setItem('spark_final_db', JSON.stringify(app.state.db));
            app.navigate('data');
            app.closeModal();
            app.state.currentImg = null;
            document.getElementById('previewBox').classList.add('hidden');
        };
        window.onload = () => app.init();
    </script>
</body>
</html>
